# 애플리케이션 수준의 보안

## 인증과 인가

인증(Authentication)은 사용자가 누구인지 증명하는 것이고 인가(Authorization)는 인증된 사람의 권한들을 의미한다. 우리는 클라이언트로서 웹 사이트를 HTTP로 이용할 때 일반적으로 최초 로그인을 통해 '인증'을 한 뒤 상태를 유지한다. 하지만 Http의 Stateless한 특성 때문에 서버는 매 요청마다 클라이언트가 누군지 확인해야 한다. 이 때 사용되는 것이 인증시 생성된 쿠키나 토큰이며 매 요청마다 요청의 헤더에 포함되어 전송되고 서버는 이를 통해 사용자의 인증과 인가를 매번 확인한다. 

> 쿠키와 로컬 스토리지
쿠키는 서버에서 생성하여 응답시 클라이언트로 전달하여 매 요청시 이 쿠키를 이용하여 클라이언트의 상태를 유지할 수 있다. 4KB 정도의 작은 크기지만 대부분의 브라우저가 지원하고 문자열만 지원한다는 특징을 갖는다. 반면 로컬스토리지는 클라이언트에 데이터를 영구적으로 저장할 수 있는 공간으로 MB단위의 큰 용량을 가지고 JS의 원시형 데이터 및 객체 등을 저장할 수 있다.

## Interceptor vs Filter in Spring

Filter와 Interceptor 모두 Controller에 HTTP 요청과 응답이 들어오고 나갈 때 처리해야 할 작업들을 수행하는 것을 의미한다. Filter은 전체 웹 애플리케이션에 적용되며 컨트롤러 도달 전 실행되고 Interceptor은 특정 컨트롤러 메서드나 핸들러에 컨트롤러 도달 후 실행되는 특징을 가진다. 또, Filter은 서블릿 필터로 주로 요청 및 응답을 수정하는데 사용되는 반면 Interceptor은 handlerIntercptor 인터페이스를 사용하여 Spring MVC 인터셉터로 구현되는 특징을 가진다.

## 암호화와 복호화

암호화는 평문 데이터를 암호화 알고리즘을 사용하여 암호화된 데이터로 변환하는 것을 의미하고, 복호화는 암호화된 데이터를 기존 평문 데이터로 변환시키는 것을 의미한다.

> 단방향 암호화와 양방향 암호화
단방향 암호화는 암호화된 데이터를 다시 평문 데이터로 변환할 수 없는 데이터를 의미한다. 이는 비밀번호 등 보안적으로 중요하여 저장시에도 암호화된 상태로 저장되어야 하는 분야에 사용되는 반면 양방향 암호화는 다시 복호화할 필요가 있는 중요 정보 등에 사용되는 방법이다. HTTPS에 사용되는 대칭키 암호화가 대표적인 양방향 암호화라고 할 수 있다. 

> Hashing algorithm
해싱 알고리즘이란 임의의 크기를 가진 데이터를 고정된 크기의 추정하기 어려운 데이터로 변환하는 알고리즘을 의미한다. 이를 통해 데이터의 무결성을 확인할 수 있으며 암호화의 핵심적인 기법이다. 또한, 해시 함수를 사용하여 비밀번호 등을  저장할 때 소금을 치듯 비밀번호에 무작위 문자열을 추가하여 암호화하는 salt 방식이 존재한다. 이는 소금을 치는 순간 발생할 수 있는 암호화 기술의 약점을 보완할 수 있기 때문에 사용한다.

> 대칭키 암호화와 공개키 암호화
대칭키 암호화는 암호화와 복호화에 사용하는 비밀키가 같은 암호화 방식이다. 암호화된 데이터를 주고 받기 전에 동일한 비밀키를 공유하고 암호화된 데이터를 비밀키로 복호화한다. 한편, 공개키 암호화는 비대칭키 암호화라고도 불리며 개인키로만 암호화된 데이터를 복호화할 수 있는 암호화 방식을 의미한다. 따라서 공개키 방식으로 B라는 수신자에게 데이터를 암호화하여 보내려면 B의 공개키로 암호화해서 B에게 보내주면 B는 본인의 개인키로 복호화할 수 있는 것이다.

## OAuth 2.0

OAuth 2.0은 인증 및 권한 부여 프로토콜로 사용자 인증 정보를 다른 애플리케이션과 공유하여 사용자의 정보를 안전하게 공유하는 보장하는 프로토콜이다.
흔히 우리가 로그인 창에서 만나는 Google 로그인, Kakao 로그인, Naver 로그인 등 일반적으로 사용자가 많은 어플리케이션에 등록된 기존 사용자 정보를 활용하여 안전하게 새로운 애플리케이션에서도 응용할 수 있도록 하는 것이다.
최초 클라이언트가 인증 서버로부터 Access Token을 얻은 후 리소스 서버에게 이 토큰을 전달하면서 필요한 자원을 요청하고 토큰이 유효하다면 자원을 제공하는 메커니즘을 갖는다.

> Bearer Token(전달자 토큰)옵션
OAuth 2.0 프로토콜에서 사용되는 인증 방식 중 하나로 액세스 토큰을 HTTP 요청 헤더에 넣어 전송하는 방식이다. 서버에서 세션관리를 하지 않고 클라이언트 측에서 토큰만으로 인증을 수행하여 애플리케이션 성능 향상에 도움이 될 수 있지만 이 토큰이 탈취되면 액세스 권한도 탈취되는 것이므로 HTTPS를 통해 통신을 암호화하거나 액세스 토큰의 유효기간을 짧게 설정하여 보안을 강화하는 등의 노력이 필요하다.

> Argon2이란?
단방향 비밀번호 해시 함수로서 해싱 전 Salt를 수차례 한 후 이를 여러 번 해시 값을 계산하여 보안성을 강화되었다.

## JWT

JWT는 JSON Web Token의 약자로 JSON 형태의 데이터를 사용한 토큰 기반 인증 방식을 의미한다. Header, Payload, Signature로 구성되어 있고 Header에는 토큰의 유형과 해싱 알고리즘이, Payload에는 토큰에 포함될 정보들이(사용자 정보, 발급 시간 등), Signature에는 토큰 유효성 검사를 위한 데이터가 명시되어있다. Signature은 Header와 Payload를 합쳐 비밀키를 통해 해싱한 값이며 이 값이 맞지 않다면 유효성 검사에 통과할 수 없다.

[JWT](https://velog.io/@tjdgns526/%EC%BF%A0%ED%82%A4-%EC%84%B8%EC%85%98-%EA%B7%B8%EB%A6%AC%EA%B3%A0-%ED%86%A0%ED%81%B0JWT)

> Claims-based identity란
claim을 기반으로 한 인증 및 권한 부여 및 보안 접근 모델이다. claim이란 사용자 정보(이름, Email, 번호) 등을 의미하고 인증 서비스는 클라이언트가 제시한 claim을 확인하여 권한이 있으면 요청 페이지를 제공하고 아니라면 제한하는 형태를 가진다.